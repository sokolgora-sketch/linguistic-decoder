rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Public analyses cache (write-only via your app)
    match /analyses/{cacheId} {
      allow read: if true;     // public readable cache is fine
      allow write: if request.auth != null; // your app writes; tighten later if needed
    }

    // Per-user history
    match /users/{uid}/history/{doc} {
      allow read, list: if request.auth != null && request.auth.uid == uid;
      allow create, update, delete: if request.auth != null && request.auth.uid == uid;
    }
  }
}
